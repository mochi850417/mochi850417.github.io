!function(e){function t(t,r){var o=t.data("jqae");o||(o={});var a=o.wrapperElement;a||(a=t.wrapInner("<div/>").find(">div")).css({margin:0,padding:0,border:0});var l=a.data("jqae");l||(l={});var s=l.originalContent;s?a=l.originalContent.clone(!0).data("jqae",{originalContent:s}).replaceAll(a):a.data("jqae",{originalContent:a.clone(!0)}),t.data("jqae",{wrapperElement:a,containerWidth:t.width(),containerHeight:t.height()});var c=t.height(),f=(parseInt(t.css("padding-top"),10)||0)+(parseInt(t.css("border-top-width"),10)||0)-(a.offset().top-t.offset().top),h=!1,d=a;r.selector&&(d=e(a.find(r.selector).get().reverse())),d.each(function(){var t=e(this),o=t.text(),l=!1;if(a.innerHeight()-t.innerHeight()>c+f)t.remove();else if(i(t),t.contents().length){for(h&&(n(t).get(0).nodeValue+=r.ellipsis,h=!1);a.innerHeight()>c+f;){if(!(l=function(t){var i=n(t);if(i.length){var r=i.get(0).nodeValue,o=r.lastIndexOf(" ");return o>-1?(r=e.trim(r.substring(0,o)),i.get(0).nodeValue=r):i.get(0).nodeValue="",!0}return!1}(t))){h=!0,t.remove();break}if(i(t),!t.contents().length){h=!0,t.remove();break}n(t).get(0).nodeValue+=r.ellipsis}"onEllipsis"==r.setTitle&&l||"always"==r.setTitle?t.attr("title",o):"never"!=r.setTitle&&t.removeAttr("title")}})}function n(e){if(e.contents().length){var t=(i=e.contents()).eq(i.length-1);return t.filter(r).length?t:n(t)}e.append("");var i;return(i=e.contents()).eq(i.length-1)}function i(t){if(t.contents().length){var n=t.contents(),o=n.eq(n.length-1);if(o.filter(r).length){var a=o.get(0).nodeValue;return""==(a=e.trim(a))&&(o.remove(),!0)}for(;i(o););return!o.contents().length&&(o.remove(),!0)}return!1}function r(){return 3===this.nodeType}function o(n,i){l[n]=i,a||(a=window.setInterval(function(){!function(){if(!s){s=!0;for(var n in l)e(n).each(function(){var i,r;i=e(this),(r=i.data("jqae")).containerWidth==i.width()&&r.containerHeight==i.height()||t(i,l[n])});s=!1}}()},200))}var a,l={},s=!1,c={ellipsis:"...",setTitle:"never",live:!1};e.fn.ellipsis=function(n,i){var r,s;return r=e(this),"string"!=typeof n&&(i=n,n=void 0),s=e.extend({},c,i),s.selector=n,r.each(function(){t(e(this),s)}),s.live?o(r.selector,s):function(e){l[e]&&(delete l[e],l.length||a&&(window.clearInterval(a),a=void 0))}(r.selector),this}}(jQuery);