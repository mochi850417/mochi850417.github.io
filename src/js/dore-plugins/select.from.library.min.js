$.selectFromLibrary=function(e,t){function s(){d=$(o.settings.itemContainerClass),m=g.find(o.settings.submitButtonClass),f=m.html(),d.each(function(){$(this).find(".custom-control-input").prop("checked",!1),$(this).find(".active").removeClass("active")}),g.modal(g.data()),1==o.settings.count?d.each(function(){$(this).find(".custom-checkbox").css("visibility","hidden")}):d.each(function(){$(this).find(".custom-checkbox").css("visibility","visible")}),m.on("click",n),g.on("change",o.settings.itemContainerClass+" .custom-control-input",i),g.on("hidden.bs.modal",c)}function i(e){if(u=$(o.settings.itemContainerClass+" .custom-control-input:checked").parents(o.settings.itemContainerClass),1==o.settings.count)return n(null),void r.css("visibility","hidden");m.html(u.length>0?f+" ("+u.length+")":f)}function n(e){e&&e.preventDefault(),a(u),function(){for(var e,t,s=r.parent().parent(),i=0;i<h.length;i++){e=r.parent().clone().empty(),(t=r.parent().find(o.settings.selectedItemClass).clone()).find(o.settings.selectedItemImageClass).attr("src",h[i].previewPath),t.find(o.settings.selectedItemLabelClass).html(h[i].label),t.css("display","block"),t.addClass(o.settings.selectedItemClassActive.replace(".","")),e.append(t),s.prepend(e),t.on("click",o.settings.selectedItemDeleteClass,l);for(var n in h[i])t.data(n,h[i][n])}}(),g.modal("hide")}function l(e){e.preventDefault(),$(this).parents(o.settings.selectedItemClass).off("click",o.settings.selectedItemDeleteClass,l),$(this).parents(o.settings.selectedItemClass).parent().remove(),a(r.parent().parent().find(o.settings.selectedItemClassActive)),1==o.settings.count&&r.css("visibility","visible")}function a(e){h=[],e&&e.each(function(){h.push($(this).data())})}function c(e){m.html(f),m.off("click",n),g.off("change",o.settings.itemContainerClass+" .custom-control-input",i),g.off("hidden.bs.modal",c)}var o=this,r=$(e);o.settings=$.extend({},{count:1,libraryId:"#modal",submitButtonClass:".sfl-submit",itemContainerClass:".sfl-item-container",selectedItemClass:".sfl-selected-item",selectedItemClassActive:".sfl-selected-item-active",selectedItemImageClass:".sfl-selected-item-image",selectedItemLabelClass:".sfl-selected-item-label",selectedItemDeleteClass:".sfl-delete-item"},t,r.data());var d,m,f,u,h,g=o.settings.libraryId.indexOf("#")>-1?$(o.settings.libraryId):$("#"+o.settings.libraryId);r.on("click",function(e){e.preventDefault(),s()}),o.getData=function(){return h||[]}},$.fn.selectFromLibrary=function(e){return this.each(function(){if(void 0==$(this).data("selectFromLibrary")){var t=new $.selectFromLibrary(this,e);$(this).data("selectFromLibrary",t)}})};